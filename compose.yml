services:
  arya:
    build: ./dnsserver
    hostname: arya
    networks:
      rede_stark:
        ipv4_address: 192.168.10.11
    cap_add:
      - NET_ADMIN
    volumes:
      - ./arya/named.conf.local:/etc/bind/named.conf.local
      - ./arya/named.conf.options:/etc/bind/named.conf.options
      - ./arya/zonas:/var/cache/bind/zonas
  ned:
    build: ./kea
    hostname: ned
    networks:
      rede_stark:
        ipv4_address: 192.168.10.10
        interface_name: eth1
    cap_add:
      - NET_ADMIN
    command: "bash -d /sbin/entrypoint.sh"
    volumes:
      - ./ned/entrypoint.sh:/sbin/entrypoint.sh
      - ./ned/dhcp4.json:/etc/kea/dhcp4.conf
      - ./ned/ddns.json:/etc/kea/ddns.conf
  router:
    build: ./router
    hostname: router
    cap_add:
      - NET_ADMIN
    sysctls:
      - net.ipv4.ip_forward=1
    networks:
      rede_wan:
        ipv4_address: 192.0.2.254
        interface_name: eth0
      rede_stark:
        ipv4_address: 192.168.10.254
        interface_name: eth1
      rede_lannister:
        ipv4_address: 192.168.11.254
        interface_name: eth2
      rede_targaryen:  
        ipv4_address: 192.168.12.254
        interface_name: eth3
  bran:
    build: ./cliente
    hostname: bran
    depends_on:
      - ned
      - arya
    networks:
      rede_stark:
        mac_address: 00:11:22:33:44:55  # direcciÃ³n HW fija
    cap_add:
      - NET_ADMIN
    command: >
      sh -c "ip addr flush dev eth0 && dhclient -v eth0 && sleep infinity"
  
  cliente1:
    build: ./cliente
    hostname: cliente1
    depends_on:
      - ned
      - arya
    networks:
      rede_stark:
        mac_address: 02:42:0a:00:00:01
    cap_add:
      - NET_ADMIN
    command: >
      sh -c "ip addr flush dev eth0 && dhclient -v eth0 && sleep infinity"
  
  cliente2:
    build: ./cliente
    hostname: cliente2
    depends_on:
      - ned
      - arya
    networks:
      rede_stark:
        mac_address: 02:42:0a:00:00:02
    cap_add:
      - NET_ADMIN
    command: >
      sh -c "ip addr flush dev eth0 && dhclient -v eth0 && sleep infinity"
  
  cliente3:
    build: ./cliente
    hostname: cliente3
    depends_on:
      - ned
      - arya
    networks:
      rede_stark:
        mac_address: 02:42:0a:00:00:03
    cap_add:
      - NET_ADMIN
    command: >
      sh -c "ip addr flush dev eth0 && dhclient -v eth0 && sleep infinity"
  
  cliente4:
    build: ./cliente
    hostname: cliente4
    depends_on:
      - ned
      - arya
    networks:
      rede_stark:
        mac_address: 02:42:0a:00:00:04
    cap_add:
      - NET_ADMIN
    command: >
      sh -c "ip addr flush dev eth0 && dhclient -v eth0 && sleep infinity"
  
  cliente5:
    build: ./cliente
    hostname: cliente5
    depends_on:
      - ned
      - arya
    networks:
      rede_stark:
        mac_address: 02:42:0a:00:00:05
    cap_add:
      - NET_ADMIN
    command: >
      sh -c "ip addr flush dev eth0 && dhclient -v eth0 && sleep infinity"
  
  cliente6:
    build: ./cliente
    hostname: cliente6
    depends_on:
      - ned
      - arya
    networks:
      rede_stark:
        mac_address: 02:42:0a:00:00:06
    cap_add:
      - NET_ADMIN
    command: >
      sh -c "ip addr flush dev eth0 && dhclient -v eth0 && sleep infinity"
  
  cliente7:
    build: ./cliente
    hostname: cliente7
    depends_on:
      - ned
      - arya
    networks:
      rede_stark:
        mac_address: 02:42:0a:00:00:07
    cap_add:
      - NET_ADMIN
    command: >
      sh -c "ip addr flush dev eth0 && dhclient -v eth0 && sleep infinity"
  
  cliente10:
    build: ./cliente
    hostname: cliente10
    depends_on:
      - ned
      - arya
    networks:
      rede_lannister:
        mac_address: 02:42:0b:00:00:0a
    cap_add:
      - NET_ADMIN
    command: >
      sh -c "ip addr flush dev eth0 && dhclient -v eth0 && sleep infinity"
  
  cliente20:
    build: ./cliente
    hostname: cliente20
    depends_on:
      - ned
      - arya
    networks:
      rede_targaryen:
        mac_address: 02:42:0c:00:00:14
    cap_add:
      - NET_ADMIN
    command: >
      sh -c "ip addr flush dev eth0 && dhclient -v eth0 && sleep infinity"
networks:
  rede_stark:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.10.0/24
  rede_lannister:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.11.0/24
  rede_targaryen:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.12.0/24
  rede_wan:
    driver: bridge
    ipam:
      config:
        - subnet: 192.0.2.0/24 